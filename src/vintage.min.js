/**
 * vintageJS is a jQuery plugin that uses the HTML5 canvas element to add a vintage look to images
 *
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Built on top of the jQuery library
 * http://jquery.com
 *
 *
 * @author Robert Fleischmann
 * @version 1.0.0
 */
jQuery.fn.vintage=function(c){var j=[0,0,1,2,3,3,4,4,5,5,6,6,7,7,7,8,8,9,9,9,10,10,10,11,11,12,12,12,13,13,14,14,15,15,16,16,17,17,18,19,19,20,21,22,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,44,45,47,48,49,51,52,54,55,57,59,60,62,64,65,67,69,70,72,74,76,77,79,81,83,85,86,88,90,92,94,96,97,99,101,103,105,107,109,111,112,114,116,118,120,122,124,126,127,129,131,133,135,136,138,140,142,143,145,147,149,150,152,154,155,157,159,160,162,163,165,167,168,170,171,173,174,176,177,178,180,181,
183,184,185,187,188,189,190,192,193,194,195,196,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,219,220,221,222,223,224,224,225,226,227,227,228,229,229,230,231,232,232,233,234,234,235,236,236,237,238,238,239,239,240,241,241,242,242,243,244,244,245,245,246,247,247,248,248,249,249,250,251,251,252,252,253,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],k=[0,1,2,3,5,6,7,8,10,11,12,13,15,16,17,18,19,21,22,23,24,26,
27,28,29,31,32,33,34,35,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,56,57,58,59,60,61,63,64,65,66,67,68,69,71,72,73,74,75,76,77,79,80,81,82,83,84,85,86,88,89,90,91,92,93,94,95,96,97,99,100,101,102,103,104,105,106,107,108,109,110,111,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,174,175,176,177,
178,179,180,181,182,183,184,185,186,186,187,188,189,190,191,192,193,194,195,195,196,197,198,199,200,201,202,202,203,204,205,206,207,208,208,209,210,211,212,213,214,214,215,216,217,218,219,219,220,221,222,223,223,224,225,226,227,228,228,229,230,231,232,232,233,234,235,236,236,237,238,239,239,240,241,242,242,243,244,245,246,246,247,248,249,249,250,251,252,252,253,254,255],l=[53,53,54,54,55,55,56,57,57,58,58,59,59,60,61,61,62,62,63,63,64,65,65,66,66,67,67,68,69,69,70,70,71,71,72,73,73,74,74,75,75,76,
77,77,78,78,79,79,80,81,81,82,82,83,83,84,85,85,86,86,87,87,88,89,89,90,90,91,91,92,93,93,94,94,95,95,96,97,97,98,98,99,99,100,101,101,102,102,103,103,104,105,105,106,106,107,107,108,109,109,110,110,111,111,112,113,113,114,114,115,115,116,117,117,118,118,119,119,120,121,121,122,122,123,123,124,125,125,126,126,127,128,128,129,129,130,130,131,132,132,133,133,134,134,135,136,136,137,137,138,138,139,140,140,141,141,142,142,143,144,144,145,145,146,146,147,148,148,149,149,150,150,151,152,152,153,153,154,
154,155,156,156,157,157,158,158,159,160,160,161,161,162,162,163,164,164,165,165,166,166,167,168,168,169,169,170,170,171,172,172,173,173,174,174,175,176,176,177,177,178,178,179,180,180,181,181,182,182,183,184,184,185,185,186,186,187,188,188,189,189,190,190,191,192,192,193,193,194,194,195,196,196,197,197,198,199],m={vignette:{black:0.7,white:0.2},noise:25,screen:false,desaturate:1,allowMultiEffect:false},n={vignette:{black:0.6,white:0.1},noise:25,screen:{red:141,green:107,blue:3,strength:0.47},desaturate:0.7,
allowMultiEffect:false},o={vignette:false,noise:false,screen:false,desaturate:false,allowMultiEffect:true};c=c||{};c.preset=c.preset||"default";switch(c.preset){case "custom":c=jQuery.extend(o,c);break;case "sepia":c=jQuery.extend(n,c);break;case "grayscale":c=jQuery.extend(m,c);break;default:c=jQuery.extend({vignette:{black:0.6,white:0.1},noise:20,screen:{red:227,green:12,blue:169,strength:0.1},desaturate:false,allowMultiEffect:false},c)}return this.each(function(){var f=jQuery(this),e,d,i;if(f.is("img")){if(c.allowMultiEffect===
false)if(f.data("vintage-applied")!==true)f.data("vintage-applied",true);else return;var p=function(){d=jQuery("<canvas></canvas>").get(0);if(d.getContext){e=d.getContext("2d");var g=new Image;g.src=f.attr("src");g.onload=function(){d.width=this.width;d.height=this.height;e.drawImage(this,0,0,this.width,this.height,0,0,d.width,d.height);if(c.vignette!==false){var a,b=Math.sqrt(Math.pow(d.width/2,2)+Math.pow(d.height/2,2));e.globalCompositeOperation="source-over";a=e.createRadialGradient(d.width/2,
d.height/2,0,d.width/2,d.height/2,b);a.addColorStop(0,"rgba(0,0,0,0)");a.addColorStop(0.65,"rgba(0,0,0,0)");a.addColorStop(1,"rgba(0,0,0,"+c.vignette.black+")");e.fillStyle=a;e.fillRect(0,0,d.width,d.height);e.globalCompositeOperation="lighter";a=e.createRadialGradient(d.width/2,d.height/2,0,d.width/2,d.height/2,b);a.addColorStop(0,"rgba(255,255,255,"+c.vignette.white+")");a.addColorStop(0.65,"rgba(255,255,255,0)");a.addColorStop(1,"rgba(0,0,0,0)");e.fillStyle=a;e.fillRect(0,0,d.width,d.height)}a=
e.getImageData(0,0,d.width,d.height);for(b=0;b<a.data.length;b+=4){if(c.desaturate!==false){var h=(j[a.data[b]]+k[a.data[b+1]]+l[a.data[b+2]])/3;a.data[b]+=Math.round((h-a.data[b])*c.desaturate);a.data[b+1]+=Math.round((h-a.data[b+1])*c.desaturate);a.data[b+2]+=Math.round((h-a.data[b+2])*c.desaturate)}else{a.data[b]=j[a.data[b]];a.data[b+1]=k[a.data[b+1]];a.data[b+2]=l[a.data[b+2]]}if(c.screen!==false){a.data[b]=255-(255-a.data[b])*(255-c.screen.red*c.screen.strength)/255;a.data[b+1]=255-(255-a.data[b+
1])*(255-c.screen.green*c.screen.strength)/255;a.data[b+2]=255-(255-a.data[b+2])*(255-c.screen.blue*c.screen.strength)/255}if(c.noise>0){h=Math.round(c.noise-Math.random()*c.noise/2);a.data[b]+=h;a.data[b+1]+=h;a.data[b+2]+=h;if(a.data[b]>255)a.data[b]=255;else if(a.data[b]<0)a.data[b]=0;if(a.data[b+1]>255)a.data[b+1]=255;else if(a.data[b+1]<0)a.data[b+1]=0;if(a.data[b+2]>255)a.data[b+2]=255;else if(a.data[b+2]<0)a.data[b+2]=0}}e.putImageData(a,0,0);f.attr("src",d.toDataURL());i.remove()}}else i.addClass("error").html("Your browser does not support the canvas element.").animate({opacity:"+=0"},
3E3,function(){$(this).fadeOut(300,function(){$(this).remove()})})};(function(){var g=f.offset();g.top+=Math.round(f.height()/2);g.left+=Math.round(f.width()/2);i=jQuery('<div class="vintage-loader">Loading&hellip;</div>');i.css("top",g.top+"px").css("left",g.left+"px").hide().appendTo("body").fadeTo(0,0.8,function(){p()})})()}})};
