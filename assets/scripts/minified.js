/*
 Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 @author Robert Fleischmann
 @version 1.1.0
*/
(function(c,f,a,g){c.fn.vintage=function(g,e){var p=function(c,g,e){if(!1===c instanceof HTMLImageElement)throw"The element (1st parameter) must be an instance of HTMLImageElement";var p,l,y,s,r,t,h,k,v=a.createElement("canvas"),m=v.getContext("2d"),q={onStart:function(){},onStop:function(){},onError:function(){},mime:"image/jpeg"},z={curves:!1,screen:!1,desaturate:!1,vignette:!1,lighten:!1,noise:!1,viewFinder:!1,sepia:!1};l=function(a){q.onStart();var c={},b;for(b in z)c[b]=a[b]||z[b];r=new Image;
r.onload=function(){h=v.width=r.width;k=v.height=r.height;s=[];c.viewFinder&&s.push(c.viewFinder);p(function(){y(c)})};r.onerror=q.onError;r.src=t};p=function(a){if(0===s.length)return a();var c=s.pop(),b=[h,k,c].join("-");if(f.vjsImageCache&&f.vjsImageCache[b])return p(a);var g=new Image;g.onload=function(){m.clearRect(0,0,h,k);m.drawImage(g,0,0,h,k);(f.vjsImageCache||(f.vjsImageCache={}))[b]=m.getImageData(0,0,h,k).data;p(a)};g.onerror=q.onError;g.src=c};y=function(a){var g,b;m.clearRect(0,0,h,
k);m.drawImage(r,0,0,h,k);if(a.vignette||a.lighten)g=Math.sqrt(Math.pow(h/2,2)+Math.pow(k/2,2));a.vignette&&(m.globalCompositeOperation="source-over",b=m.createRadialGradient(h/2,k/2,0,h/2,k/2,g),b.addColorStop(0,"rgba(0,0,0,0)"),b.addColorStop(0.5,"rgba(0,0,0,0)"),b.addColorStop(1,["rgba(0,0,0,",a.vignette,")"].join("")),m.fillStyle=b,m.fillRect(0,0,h,k));a.lighten&&(m.globalCompositeOperation="lighter",b=m.createRadialGradient(h/2,k/2,0,h/2,k/2,g),b.addColorStop(0,["rgba(255,255,255,",a.lighten,
")"].join("")),b.addColorStop(0.5,"rgba(255,255,255,0)"),b.addColorStop(1,"rgba(0,0,0,0)"),m.fillStyle=b,m.fillRect(0,0,h,k));g=m.getImageData(0,0,h,k);var e,p,l,d=g.data,n;a.viewFinder&&(n=f.vjsImageCache[[h,k,a.viewFinder].join("-")]);for(var u=h*k;0<=u;--u){b=u<<2;a.curves&&(d[b]=a.curves.r[d[b]],d[b+1]=a.curves.g[d[b+1]],d[b+2]=a.curves.b[d[b+2]]);a.screen&&(d[b]=255-(255-d[b])*(255-a.screen.r*a.screen.a)/255,d[b+1]=255-(255-d[b+1])*(255-a.screen.g*a.screen.a)/255,d[b+2]=255-(255-d[b+2])*(255-
a.screen.b*a.screen.a)/255);a.noise&&(e=a.noise-Math.random()*a.noise/2,d[b]+=e,d[b+1]+=e,d[b+2]+=e);a.viewFinder&&(d[b]=d[b]*n[b]/255,d[b+1]=d[b+1]*n[b+1]/255,d[b+2]=d[b+2]*n[b+2]/255);a.sepia&&(e=d[b],p=d[b+1],l=d[b+2],d[b]=0.393*e+0.769*p+0.189*l,d[b+1]=0.349*e+0.686*p+0.168*l,d[b+2]=0.272*e+0.534*p+0.131*l);a.desaturate&&(e=(d[b]+d[b+1]+d[b+2])/3,d[b]+=(e-d[b])*a.desaturate,d[b+1]+=(e-d[b+1])*a.desaturate,d[b+2]+=(e-d[b+2])*a.desaturate);for(e=2;0<=e;--e)d[b+e]=~~(255<d[b+e]?255:0>d[b+e]?0:d[b+
e])}m.putImageData(g,0,0);c.src=m.canvas.toDataURL(q.mime);q.onStop()};t=c.src;g=g||{};for(var w in q)q[w]=g[w]||q[w];e&&l(e);return{apply:function(){t=c.src},reset:function(){c.src=t},vintage:l}};return this.each(function(){c.data(this,"vintageJS")||c.data(this,"vintageJS",new p(this,g,e))})}})(jQuery,window,document);
var vintagePresets={vintage:{curves:function(){for(var c=function(a){return-12*Math.sin(2*a*Math.PI/255)+a},f=function(a){return-0.2*Math.pow(255*a,0.5)*Math.sin(Math.PI*(-1.95E-5*Math.pow(a,2)+0.0125*a))+a},a=function(a){return-0.001045244139166791*Math.pow(a,2)+1.2665372554875318*a},g=function(a){return 0.57254902*a+53},l={r:[],g:[],b:[]},e=0;255>=e;++e)l.r[e]=f(c(e)),l.g[e]=a(c(e)),l.b[e]=g(c(e));return l}(),screen:{r:227,g:12,b:169,a:0.15},vignette:0.7,viewFinder:"assets/images/viewfinder.jpg"},
sepia:{curves:function(){for(var c=function(a){return-12*Math.sin(2*a*Math.PI/255)+a},f={r:[],g:[],b:[]},a=0;255>=a;++a)f.r[a]=c(a),f.g[a]=c(a),f.b[a]=c(a);return f}(),sepia:!0},greenish:{curves:function(){for(var c=function(a){return-12*Math.sin(2*a*Math.PI/255)+a},f={r:[],g:[],b:[]},a=0;255>=a;++a)f.r[a]=c(a),f.g[a]=c(a),f.b[a]=c(a);return f}(),vignette:0.6,lighten:0.1,screen:{r:255,g:255,b:0,a:0.15}},reddish:{curves:function(){for(var c=function(a){return-12*Math.sin(2*a*Math.PI/255)+a},f={r:[],
g:[],b:[]},a=0;255>=a;++a)f.r[a]=c(a),f.g[a]=c(a),f.b[a]=c(a);return f}(),vignette:0.6,lighten:0.1,screen:{r:255,g:0,b:0,a:0.15}},random:function(){var c=[!1,"assets/images/viewfinder.jpg"],f=function(){if(0.5<=Math.random())return!1;for(var a=5<=Math.random(),c=5<=Math.random()?c:function(a){return a},e=a?e:function(a){return a},f=a?f:function(a){return a},x=a?x:function(a){return a},a={r:[],g:[],b:[]},n=0;255>=n;++n)a.r[n]=e(c(n)),a.g[n]=f(c(n)),a.b[n]=x(c(n));return a}(),a;a=0.5<=Math.random()?
!1:{r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.random()};return{curves:f,screen:a,desaturate:Math.random(),vignette:Math.random(),lighten:Math.random(),noise:Math.floor(50*Math.random()),viewFinder:c[Math.floor(Math.random()*c.length)],sepia:0.5<=Math.random()}}},Slideshow=function(c){var f=c.find("li"),a=0,g=f.length-1,l=function(c){f.eq(c?0>a-1?g:--a:a+1>g?0:++a).trigger("click")};c.on("click","li",function(){var e=$(this);e.hasClass("active")||
(e.siblings(".active").addBack().toggleClass("active"),a=e.index(),c.trigger("slideshow:change",[e]))}).on("click",".js_next",function(){l()}).on("click",".js_prev",function(){l(!0)});return{getCurrentSlide:function(){return f.eq(a)}}},active="active",click="click",disabled="disabled",$slideshow=$(".js_slideshow"),$controls=$(".js_controls"),$select=$controls.find("select"),$reload=$controls.find(".js_reload"),slideshow=new Slideshow($slideshow);$(".js_toggle").on(click,"dt",function(){$(this).addClass(active).siblings("dt").removeClass(active)});
$slideshow.find("img").vintage();$.each(vintagePresets,function(c,f){$select.append(['<option value="',c,'">',[c.charAt(0).toUpperCase(),c.substr(1)].join(""),"</option>"].join(""))});
$controls.on("change","select",function(){var c=this.value,f=slideshow.getCurrentSlide(),a=f.find("img").data("vintageJS");c in vintagePresets?(f.data("currEffect",c),"random"===c?($reload.removeClass(disabled),a.vintage(vintagePresets[c]())):($reload.addClass(disabled),a.vintage(vintagePresets[c]))):(f.data("currEffect",!1),a.reset())}).on(click,".js_reload",function(){$select.trigger("change")});
$slideshow.on("slideshow:change",function(c,f){var a=f.data("currEffect");$select.val(a||"");$reload.toggleClass(disabled,"random"!==a)});$.getScript([/^http:/.test(document.location)?"http":"https","://platform.twitter.com/widgets.js"].join(""));$(".ghbuttons .download").after('<iframe src="http://ghbtns.com/github-btn.html?user=rendro&amp;repo=vintageJS&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe><iframe src="http://ghbtns.com/github-btn.html?user=rendro&amp;repo=vintageJS&amp;type=fork&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>');
