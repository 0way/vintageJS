(function(c,d,a){c.fn.vintage=function(g,h){var f=function(f,c,g){if(!1===f instanceof HTMLImageElement)throw"The element (1st parameter) must be an instance of HTMLImageElement";var h,t,w,m,r,p,j,k,u=a.createElement("canvas"),l=u.getContext("2d"),q={onStart:function(){},onStop:function(){},onError:function(){},mime:"image/jpeg"},x={curves:!1,screen:!1,desaturate:!1,vignette:!1,lighten:!1,noise:!1,viewFinder:!1,sepia:!1};t=function(a){q.onStart();var f={},b;for(b in x)f[b]=a[b]||x[b];r=new Image;
r.onload=function(){j=u.width=r.width;k=u.height=r.height;m=[];f.viewFinder&&m.push(f.viewFinder);h(function(){w(f)})};r.onerror=q.onError;r.src=p};h=function(a){if(0===m.length)return a();var f=m.pop(),b=[j,k,f].join("-");if(d.vjsImageCache&&d.vjsImageCache[b])return h(a);var c=new Image;c.onload=function(){l.clearRect(0,0,j,k);l.drawImage(c,0,0,j,k);(d.vjsImageCache||(d.vjsImageCache={}))[b]=l.getImageData(0,0,j,k).data;h(a)};c.onerror=q.onError;c.src=f};w=function(a){var c,b;l.clearRect(0,0,j,
k);l.drawImage(r,0,0,j,k);if(a.vignette||a.lighten)c=Math.sqrt(Math.pow(j/2,2)+Math.pow(k/2,2));a.vignette&&(l.globalCompositeOperation="source-over",b=l.createRadialGradient(j/2,k/2,0,j/2,k/2,c),b.addColorStop(0,"rgba(0,0,0,0)"),b.addColorStop(0.5,"rgba(0,0,0,0)"),b.addColorStop(1,["rgba(0,0,0,",a.vignette,")"].join("")),l.fillStyle=b,l.fillRect(0,0,j,k));a.lighten&&(l.globalCompositeOperation="lighter",b=l.createRadialGradient(j/2,k/2,0,j/2,k/2,c),b.addColorStop(0,["rgba(255,255,255,",a.lighten,
")"].join("")),b.addColorStop(0.5,"rgba(255,255,255,0)"),b.addColorStop(1,"rgba(0,0,0,0)"),l.fillStyle=b,l.fillRect(0,0,j,k));c=l.getImageData(0,0,j,k);var g,h,s,e=c.data,m;a.viewFinder&&(m=d.vjsImageCache[[j,k,a.viewFinder].join("-")]);for(var p=j*k;0<=p;--p){b=p<<2;a.curves&&(e[b]=a.curves.r[e[b]],e[b+1]=a.curves.g[e[b+1]],e[b+2]=a.curves.b[e[b+2]]);a.screen&&(e[b]=255-(255-e[b])*(255-a.screen.r*a.screen.a)/255,e[b+1]=255-(255-e[b+1])*(255-a.screen.g*a.screen.a)/255,e[b+2]=255-(255-e[b+2])*(255-
a.screen.b*a.screen.a)/255);a.noise&&(g=a.noise-Math.random()*a.noise/2,e[b]+=g,e[b+1]+=g,e[b+2]+=g);a.viewFinder&&(e[b]=e[b]*m[b]/255,e[b+1]=e[b+1]*m[b+1]/255,e[b+2]=e[b+2]*m[b+2]/255);a.sepia&&(g=e[b],h=e[b+1],s=e[b+2],e[b]=0.393*g+0.769*h+0.189*s,e[b+1]=0.349*g+0.686*h+0.168*s,e[b+2]=0.272*g+0.534*h+0.131*s);a.desaturate&&(g=(e[b]+e[b+1]+e[b+2])/3,e[b]+=(g-e[b])*a.desaturate,e[b+1]+=(g-e[b+1])*a.desaturate,e[b+2]+=(g-e[b+2])*a.desaturate);for(g=2;0<=g;--g)e[b+g]=~~(255<e[b+g]?255:0>e[b+g]?0:e[b+
g])}l.putImageData(c,0,0);f.src=l.canvas.toDataURL(q.mime);q.onStop()};p=f.src;c=c||{};for(var v in q)q[v]=c[v]||q[v];g&&t(g);return{apply:function(){p=f.src},reset:function(){f.src=p},vintage:t}};return this.each(function(){c.data(this,"vintageJS")||c.data(this,"vintageJS",new f(this,g,h))})}})(jQuery,window,document);
var vintagePresets={vintage:{curves:function(){for(var c=function(a){return-12*Math.sin(2*a*Math.PI/255)+a},d={r:[],g:[],b:[]},a=0;255>=a;++a){var g=d.r,h=a,f;f=c(a);f=-0.2*Math.pow(255*f,0.5)*Math.sin(Math.PI*(-1.95E-5*Math.pow(f,2)+0.0125*f))+f;g[h]=f;g=d.g;h=a;f=c(a);f=-0.001045244139166791*Math.pow(f,2)+1.2665372554875318*f;g[h]=f;g=d.b;h=a;f=c(a);g[h]=0.57254902*f+53}return d}(),screen:{r:227,g:12,b:169,a:0.15},vignette:0.7,viewFinder:"assets/images/viewfinder.jpg"},sepia:{curves:function(){for(var c=
function(a){return-12*Math.sin(2*a*Math.PI/255)+a},d={r:[],g:[],b:[]},a=0;255>=a;++a)d.r[a]=c(a),d.g[a]=c(a),d.b[a]=c(a);return d}(),sepia:!0},greenish:{curves:function(){for(var c=function(a){return-12*Math.sin(2*a*Math.PI/255)+a},d={r:[],g:[],b:[]},a=0;255>=a;++a)d.r[a]=c(a),d.g[a]=c(a),d.b[a]=c(a);return d}(),vignette:0.6,lighten:0.1,screen:{r:255,g:255,b:0,a:0.15}},reddish:{curves:function(){for(var c=function(a){return-12*Math.sin(2*a*Math.PI/255)+a},d={r:[],g:[],b:[]},a=0;255>=a;++a)d.r[a]=
c(a),d.g[a]=c(a),d.b[a]=c(a);return d}(),vignette:0.6,lighten:0.1,screen:{r:255,g:0,b:0,a:0.15}},random:function(){var c=[!1,"assets/images/viewfinder.jpg"],d;if(0.5<=Math.random())d=!1;else{var a=5<=Math.random();d=5<=Math.random()?d:function(a){return a};for(var g=a?g:function(a){return a},h=a?h:function(a){return a},f=a?f:function(a){return a},a={r:[],g:[],b:[]},n=0;255>=n;++n)a.r[n]=g(d(n)),a.g[n]=h(d(n)),a.b[n]=f(d(n));d=a}g=0.5<=Math.random()?!1:{r:Math.floor(255*Math.random()),g:Math.floor(255*
Math.random()),b:Math.floor(255*Math.random()),a:Math.random()};return{curves:d,screen:g,desaturate:Math.random(),vignette:Math.random(),lighten:Math.random(),noise:Math.floor(50*Math.random()),viewFinder:c[Math.floor(Math.random()*c.length)],sepia:0.5<=Math.random()}}},Slideshow=function(c){var d=c.find("li"),a=0,g=d.length-1,h=function(f){d.eq(f?0>a-1?g:--a:a+1>g?0:++a).trigger("click")};c.on("click","li",function(){var f=$(this);f.hasClass("active")||(f.siblings(".active").addBack().toggleClass("active"),
a=f.index(),c.trigger("slideshow:change",[f]))}).on("click",".js_next",function(){h()}).on("click",".js_prev",function(){h(!0)});return{getCurrentSlide:function(){return d.eq(a)}}};
$(function(){var c=$(".js_slideshow"),d=$(".js_controls"),a=d.find("select"),g=d.find(".js_reload"),h=new Slideshow(c);$(".js_toggle").on("click","dt",function(){$(this).addClass("active").siblings("dt").removeClass("active")});c.find("img").vintage();$.each(vintagePresets,function(f){a.append(['<option value="',f,'">',[f.charAt(0).toUpperCase(),f.substr(1)].join(""),"</option>"].join(""))});d.on("change","select",function(){var a=this.value,c=h.getCurrentSlide(),d=c.find("img").data("vintageJS");
a in vintagePresets?(c.data("currEffect",a),"random"===a?(g.removeClass("disabled"),d.vintage(vintagePresets[a]())):(g.addClass("disabled"),d.vintage(vintagePresets[a]))):(c.data("currEffect",!1),d.reset())}).on("click",".js_reload",function(){a.trigger("change")});c.on("slideshow:change",function(c,d){var g=d.data("currEffect");a.val(g||"")});$.getScript([/^http:/.test(document.location)?"http":"https","://platform.twitter.com/widgets.js"].join(""))});
