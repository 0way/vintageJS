/*
 Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 @author Robert Fleischmann
 @version 1.1.1
*/
(function(d,e,a,g){d.fn.vintage=function(g,h){var p=function(d,g,h){if(!1===d instanceof HTMLImageElement)throw"The element (1st parameter) must be an instance of HTMLImageElement";var p,m,B,u,t,k,l,f,x,s=new Image,v=new Image,y=a.createElement("canvas"),n=y.getContext("2d"),r={onStart:function(){},onStop:function(){},onError:function(){},mime:"image/jpeg"},C={curves:!1,screen:!1,desaturate:!1,vignette:!1,lighten:!1,noise:!1,viewFinder:!1,sepia:!1,brightness:!1,contrast:!1};s.onerror=r.onError;s.onload=
function(){k=y.width=s.width;l=y.height=s.height;p()};v.onerror=r.onError;v.onload=function(){n.clearRect(0,0,k,l);n.drawImage(v,0,0,k,l);(e.vjsImageCache||(e.vjsImageCache={}))[x]=n.getImageData(0,0,k,l).data;p()};m=function(a){r.onStart();f={};for(var b in C)f[b]=a[b]||C[b];u=[];f.viewFinder&&u.push(f.viewFinder);s.src==t?p():s.src=t};p=function(){if(0===u.length)return B();var a=u.pop();x=[k,l,a].join("-");if(e.vjsImageCache&&e.vjsImageCache[x])return p();v.src=a};B=function(){var a,b;n.clearRect(0,
0,k,l);n.drawImage(s,0,0,k,l);if(f.vignette||f.lighten)a=Math.sqrt(Math.pow(k/2,2)+Math.pow(l/2,2));f.vignette&&(n.globalCompositeOperation="source-over",b=n.createRadialGradient(k/2,l/2,0,k/2,l/2,a),b.addColorStop(0,"rgba(0,0,0,0)"),b.addColorStop(0.5,"rgba(0,0,0,0)"),b.addColorStop(1,["rgba(0,0,0,",f.vignette,")"].join("")),n.fillStyle=b,n.fillRect(0,0,k,l));f.lighten&&(n.globalCompositeOperation="lighter",b=n.createRadialGradient(k/2,l/2,0,k/2,l/2,a),b.addColorStop(0,["rgba(255,255,255,",f.lighten,
")"].join("")),b.addColorStop(0.5,"rgba(255,255,255,0)"),b.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=b,n.fillRect(0,0,k,l));a=n.getImageData(0,0,k,l);var g,h,p,c=a.data,m,q;f.contrast&&(q=259*(f.contrast+255)/(255*(259-f.contrast)));f.viewFinder&&(m=e.vjsImageCache[[k,l,f.viewFinder].join("-")]);for(var w=k*l;0<=w;--w){b=w<<2;f.curves&&(c[b]=f.curves.r[c[b]],c[b+1]=f.curves.g[c[b+1]],c[b+2]=f.curves.b[c[b+2]]);f.contrast&&(c[b]=q*(c[b]-128)+128,c[b+1]=q*(c[b+1]-128)+128,c[b+2]=q*(c[b+2]-128)+128);
f.brightness&&(c[b]+=f.brightness,c[b+1]+=f.brightness,c[b+2]+=f.brightness);f.screen&&(c[b]=255-(255-c[b])*(255-f.screen.r*f.screen.a)/255,c[b+1]=255-(255-c[b+1])*(255-f.screen.g*f.screen.a)/255,c[b+2]=255-(255-c[b+2])*(255-f.screen.b*f.screen.a)/255);f.noise&&(g=f.noise-Math.random()*f.noise/2,c[b]+=g,c[b+1]+=g,c[b+2]+=g);f.viewFinder&&(c[b]=c[b]*m[b]/255,c[b+1]=c[b+1]*m[b+1]/255,c[b+2]=c[b+2]*m[b+2]/255);f.sepia&&(g=c[b],h=c[b+1],p=c[b+2],c[b]=0.393*g+0.769*h+0.189*p,c[b+1]=0.349*g+0.686*h+0.168*
p,c[b+2]=0.272*g+0.534*h+0.131*p);f.desaturate&&(g=(c[b]+c[b+1]+c[b+2])/3,c[b]+=(g-c[b])*f.desaturate,c[b+1]+=(g-c[b+1])*f.desaturate,c[b+2]+=(g-c[b+2])*f.desaturate);for(g=2;0<=g;--g)c[b+g]=~~(255<c[b+g]?255:0>c[b+g]?0:c[b+g])}n.putImageData(a,0,0);d.src=n.canvas.toDataURL(r.mime);r.onStop()};t=d.src;g=g||{};for(var z in r)r[z]=g[z]||r[z];h&&m(h);return{apply:function(){t=d.src},reset:function(){d.src=t},vintage:m}};return this.each(function(){d.data(this,"vintageJS")||d.data(this,"vintageJS",new p(this,
g,h))})}})(jQuery,window,document);
var vintagePresets={vintage:{curves:function(){for(var d=function(a){return-12*Math.sin(2*a*Math.PI/255)+a},e=function(a){return-0.2*Math.pow(255*a,0.5)*Math.sin(Math.PI*(-1.95E-5*Math.pow(a,2)+0.0125*a))+a},a=function(a){return-0.001045244139166791*Math.pow(a,2)+1.2665372554875318*a},g=function(a){return 0.57254902*a+53},m={r:[],g:[],b:[]},h=0;255>=h;++h)m.r[h]=e(d(h)),m.g[h]=a(d(h)),m.b[h]=g(d(h));return m}(),screen:{r:227,g:12,b:169,a:0.15},vignette:0.7,viewFinder:"assets/images/viewfinder.jpg"},sepia:{curves:function(){for(var d=
function(a){return-12*Math.sin(2*a*Math.PI/255)+a},e={r:[],g:[],b:[]},a=0;255>=a;++a)e.r[a]=d(a),e.g[a]=d(a),e.b[a]=d(a);return e}(),sepia:!0},greenish:{curves:function(){for(var d=function(a){return-12*Math.sin(2*a*Math.PI/255)+a},e={r:[],g:[],b:[]},a=0;255>=a;++a)e.r[a]=d(a),e.g[a]=d(a),e.b[a]=d(a);return e}(),vignette:0.6,lighten:0.1,screen:{r:255,g:255,b:0,a:0.15}},reddish:{curves:function(){for(var d=function(a){return-12*Math.sin(2*a*Math.PI/255)+a},e={r:[],g:[],b:[]},a=0;255>=a;++a)e.r[a]=
d(a),e.g[a]=d(a),e.b[a]=d(a);return e}(),vignette:0.6,lighten:0.1,screen:{r:255,g:0,b:0,a:0.15}},random:function(){var d=[!1,"assets/images/viewfinder.jpg"],e=function(){if(0.5<=Math.random())return!1;for(var a=5<=Math.random(),d=5<=Math.random()?d:function(a){return a},e=a?e:function(a){return a},p=a?p:function(a){return a},A=a?A:function(a){return a},a={r:[],g:[],b:[]},q=0;255>=q;++q)a.r[q]=e(d(q)),a.g[q]=p(d(q)),a.b[q]=A(d(q));return a}(),a;a=0.5<=Math.random()?!1:{r:Math.floor(255*Math.random()),
g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.random()};return{curves:e,screen:a,desaturate:Math.random(),vignette:Math.random(),lighten:Math.random(),noise:Math.floor(50*Math.random()),viewFinder:d[Math.floor(Math.random()*d.length)],sepia:0.5<=Math.random()}}},Slideshow=function(d){var e=d.find("li"),a=0,g=e.length-1,m=function(d){e.eq(d?0>a-1?g:--a:a+1>g?0:++a).trigger("click")};d.on("click","li",function(){var e=$(this);e.hasClass("active")||(e.siblings(".active").addBack().toggleClass("active"),
a=e.index(),d.trigger("slideshow:change",[e]))}).on("click",".js_next",function(){m()}).on("click",".js_prev",function(){m(!0)});return{getCurrentSlide:function(){return e.eq(a)}}},active="active",click="click",disabled="disabled",$slideshow=$(".js_slideshow"),$controls=$(".js_controls"),$select=$controls.find("select"),$reload=$controls.find(".js_reload"),slideshow=new Slideshow($slideshow);$(".js_toggle").on(click,"dt",function(){$(this).addClass(active).siblings("dt").removeClass(active)});$slideshow.find("img").vintage();
$.each(vintagePresets,function(d,e){$select.append(['<option value="',d,'">',[d.charAt(0).toUpperCase(),d.substr(1)].join(""),"</option>"].join(""))});
$controls.on("change","select",function(){var d=this.value,e=slideshow.getCurrentSlide(),a=e.find("img").data("vintageJS");d in vintagePresets?(e.data("currEffect",d),"random"===d?($reload.removeClass(disabled),a.vintage(vintagePresets[d]())):($reload.addClass(disabled),a.vintage(vintagePresets[d]))):(e.data("currEffect",!1),a.reset())}).on(click,".js_reload",function(){$select.trigger("change")});
$slideshow.on("slideshow:change",function(d,e){var a=e.data("currEffect");$select.val(a||"");$reload.toggleClass(disabled,"random"!==a)});$.getScript([/^http:/.test(document.location)?"http":"https","://platform.twitter.com/widgets.js"].join(""));$(".ghbuttons .download").after('<iframe src="http://ghbtns.com/github-btn.html?user=rendro&amp;repo=vintageJS&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe><iframe src="http://ghbtns.com/github-btn.html?user=rendro&amp;repo=vintageJS&amp;type=fork&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>');
